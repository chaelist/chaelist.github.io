<!DOCTYPE html>
<html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<link rel="shortcut icon" href="https://chaelist.github.io/assets/images/cat.png" type="image/x-icon">
<link rel="stylesheet" href="https://chaelist.github.io/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=G-QJ6H6890X3"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-QJ6H6890X3'); </script> <script type="text/javascript" src="https://chaelist.github.io/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="https://chaelist.github.io/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1">
<title>시계열 데이터 예측 | chaelist</title>
<meta name="generator" content="Jekyll v4.2.1">
<meta property="og:title" content="시계열 데이터 예측">
<meta property="og:locale" content="en_US">
<meta name="description" content="chaelist’s blog">
<meta property="og:description" content="chaelist’s blog">
<link rel="canonical" href="https://chaelist.github.io/docs/ml_application/time_series/">
<meta property="og:url" content="https://chaelist.github.io/docs/ml_application/time_series/">
<meta property="og:site_name" content="chaelist">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="시계열 데이터 예측"> <script type="application/ld+json"> {"description":"chaelist’s blog","url":"https://chaelist.github.io/docs/ml_application/time_series/","@type":"WebPage","headline":"시계열 데이터 예측","@context":"https://schema.org"}</script><script>MathJax={"tex":{"inlineMath":[["$","$"],["\\(","\\)"]],"displayMath":[["$$","$$"],["\\[","\\]"]]},"svg":{"fontCache":"global"}}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewbox="0 0 24 24"><title>Link</title>
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewbox="0 0 24 24"><title>Search</title>
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewbox="0 0 24 24"><title>Menu</title>
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewbox="0 0 24 24"><title>Expand</title>
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewbox="0 0 24 24"><title>Document</title>
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg><div class="side-bar">
<div class="site-header"> <a href="https://chaelist.github.io/" class="site-title lh-tight"> chaelist </a> <a href="#" id="menu-button" class="site-button"> <svg viewbox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a>
</div>
<nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list">
<li class="nav-list-item"><a href="https://chaelist.github.io/" class="nav-list-link">Home</a></li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://chaelist.github.io/docs/python_basics" class="nav-list-link">Python 기초</a><ul class="nav-list ">
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/python_basics/numbers_list_string/" class="nav-list-link">Numbers, List, String</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/python_basics/dictionary_tuple_set/" class="nav-list-link">Dictionary, Tuple, Set</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/python_basics/controlflow/" class="nav-list-link">Control Flow (제어문)</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/python_basics/function_module/" class="nav-list-link">Function &amp; Module</a></li>
</ul>
</li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://chaelist.github.io/docs/data_handling" class="nav-list-link">Data Handling</a><ul class="nav-list ">
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/data_handling/file_input_output/" class="nav-list-link">파일 읽고 쓰기</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/data_handling/file_folder_handling/" class="nav-list-link">파일 &amp; 폴더 다루기</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/data_handling/regular_expressions/" class="nav-list-link">Regular Expressions</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/data_handling/useful_functions/" class="nav-list-link">유용한 Python 내장함수</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/data_handling/datetime/" class="nav-list-link">Datetime 다루기</a></li>
</ul>
</li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://chaelist.github.io/docs/numpy" class="nav-list-link">Numpy</a><ul class="nav-list ">
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/numpy/numpy_basics/" class="nav-list-link">Numpy 기초</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/numpy/numpy_arithmetics/" class="nav-list-link">Numpy 연산과 통계</a></li>
</ul>
</li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://chaelist.github.io/docs/pandas" class="nav-list-link">Pandas</a><ul class="nav-list ">
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/pandas/pandas_basics/" class="nav-list-link">Pandas 기초</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/pandas/pandas_data_modifying/" class="nav-list-link">Pandas 데이터 가공</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/pandas/pandas_data_analysis/" class="nav-list-link">Pandas 데이터 분석</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/pandas/pandas_merge_group/" class="nav-list-link">Pandas 데이터 결합 &amp; 요약</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/pandas/pandas_str_dt_con/" class="nav-list-link">Pandas str, dt, 조건문</a></li>
</ul>
</li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://chaelist.github.io/docs/visualization" class="nav-list-link">데이터 시각화</a><ul class="nav-list ">
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/visualization/pandas_plot/" class="nav-list-link">Pandas plot() 함수</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/visualization/seaborn/" class="nav-list-link">Seaborn</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/visualization/matplotlib/" class="nav-list-link">Matplotlib</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/visualization/plotly/" class="nav-list-link">Plotly</a></li>
</ul>
</li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://chaelist.github.io/docs/webscraping" class="nav-list-link">Web Scraping</a><ul class="nav-list ">
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/webscraping/requests_beautifulsoup/" class="nav-list-link">Requests &amp; BeautifulSoup</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/webscraping/selenium/" class="nav-list-link">Selenium</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/webscraping/image_api/" class="nav-list-link">Image 수집 &amp; API 활용</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/webscraping/twitter_api/" class="nav-list-link">Twitter 데이터 수집</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/webscraping/app_review/" class="nav-list-link">App Review 수집</a></li>
</ul>
</li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://chaelist.github.io/docs/text_analysis" class="nav-list-link">Text 분석</a><ul class="nav-list ">
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/text_analysis/english_text/" class="nav-list-link">빈도 분석 (English)</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/text_analysis/korean_text/" class="nav-list-link">빈도 분석 (한글)</a></li>
</ul>
</li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://chaelist.github.io/docs/network_analysis" class="nav-list-link">Network Analysis</a><ul class="nav-list ">
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/network_analysis/network_basics/" class="nav-list-link">Network Analysis 기초</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/network_analysis/social_network/" class="nav-list-link">Social Network Analysis</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/network_analysis/semantic_network/" class="nav-list-link">Semantic Network Analysis</a></li>
</ul>
</li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://chaelist.github.io/docs/ml_basics" class="nav-list-link">Machine Learning 기초</a><ul class="nav-list ">
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/ml_basics/linear_regression/" class="nav-list-link">기초 &amp; Linear Regression</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/ml_basics/classification1/" class="nav-list-link">Classification 1</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/ml_basics/classification2/" class="nav-list-link">Classification 2</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/ml_basics/clustering/" class="nav-list-link">Clustering</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/ml_basics/deep_learning/" class="nav-list-link">Deep Learning 기초</a></li>
</ul>
</li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://chaelist.github.io/docs/ml_advanced" class="nav-list-link">Machine Learning 심화</a><ul class="nav-list ">
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/ml_advanced/regularization/" class="nav-list-link">Regularization</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/ml_advanced/preprocessing/" class="nav-list-link">데이터 전처리</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/ml_advanced/model_selection/" class="nav-list-link">Model Selection</a></li>
</ul>
</li>
<li class="nav-list-item active">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://chaelist.github.io/docs/ml_application" class="nav-list-link">Machine Learning 응용</a><ul class="nav-list ">
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/ml_application/sentiment_analysis/" class="nav-list-link">영화 리뷰 감성 분석</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/ml_application/news_clustering/" class="nav-list-link">뉴스 기사 Clustering</a></li>
<li class="nav-list-item active"><a href="https://chaelist.github.io/docs/ml_application/time_series/" class="nav-list-link active">시계열 데이터 예측</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/ml_application/topic_modeling/" class="nav-list-link">Topic Modeling (LDA)</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/ml_application/logistics/" class="nav-list-link">물류 최적화</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/ml_application/image_processing/" class="nav-list-link">이미지 / 동영상 처리</a></li>
</ul>
</li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://chaelist.github.io/docs/sql" class="nav-list-link">SQL</a><ul class="nav-list ">
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/sql/select_basics/" class="nav-list-link">데이터 조회 기초</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/sql/select_advanced/" class="nav-list-link">데이터 조회 심화</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/sql/join_subq_view/" class="nav-list-link">조인, 서브쿼리, 뷰</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/sql/db_table_create/" class="nav-list-link">데이터베이스 &amp; 테이블 구축</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/sql/modify_table/" class="nav-list-link">테이블 가공</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/sql/foreign_key_pymysql/" class="nav-list-link">Foreign Key &amp; Python 연결</a></li>
</ul>
</li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://chaelist.github.io/docs/kaggle" class="nav-list-link">Kaggle Dataset EDA</a><ul class="nav-list ">
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/kaggle/youtube_trending/" class="nav-list-link">YouTube Trending Videos</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/kaggle/amazon_bestsellers/" class="nav-list-link">Amazon Bestselling Books</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/kaggle/customer_churn/" class="nav-list-link">Telco Customer Churn</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/kaggle/kiva_crowdfunding/" class="nav-list-link">Kiva Crowdfunding 1</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/kaggle/kiva_crowdfunding2/" class="nav-list-link">Kiva Crowdfunding 2</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/kaggle/stem_salaries/" class="nav-list-link">STEM Salaries 1</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/kaggle/stem_salaries2/" class="nav-list-link">STEM Salaries 2</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/kaggle/uk_ecommerce/" class="nav-list-link">UK Ecommerce Data 1</a></li>
<li class="nav-list-item "><a href="https://chaelist.github.io/docs/kaggle/uk_ecommerce2/" class="nav-list-link">UK Ecommerce Data 2</a></li>
</ul>
</li>
</ul></nav><footer class="site-footer"></footer>
</div>
<div class="main" id="top">
<div id="main-header" class="main-header"><div class="search">
<div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search chaelist" aria-label="Search chaelist" autocomplete="off"> <label for="search-input" class="search-label"><svg viewbox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
</div>
<div id="search-results" class="search-results"></div>
</div></div>
<div id="main-content-wrap" class="main-content-wrap">
<nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list">
<li class="breadcrumb-nav-list-item"><a href="https://chaelist.github.io/docs/ml_application">Machine Learning 응용</a></li>
<li class="breadcrumb-nav-list-item"><span>시계열 데이터 예측</span></li>
</ol></nav><div id="main-content" class="main-content" role="main">
<h1 class="no_toc" id="시계열-데이터-예측"> <a href="#%EC%8B%9C%EA%B3%84%EC%97%B4-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%98%88%EC%B8%A1" aria-labelledby="시계열-데이터-예측" class="anchor-heading"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 시계열 데이터 예측</h1>
<p><br></p>
<details open=""> <summary class="text-delta"> Table of contents </summary><ol id="markdown-toc">
<li>
<a href="#prophet-%EA%B8%B0%EC%B4%88" id="markdown-toc-prophet-기초">Prophet 기초</a><ol>
<li><a href="#%EC%9D%B4%EB%A1%A0" id="markdown-toc-이론">이론</a></li>
<li><a href="#%EC%8B%9C%EA%B3%84%EC%97%B4-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A4%80%EB%B9%84" id="markdown-toc-시계열-데이터-준비">시계열 데이터 준비</a></li>
<li><a href="#prophet%EC%9C%BC%EB%A1%9C-%EC%8B%9C%EA%B3%84%EC%97%B4-%EC%98%88%EC%B8%A1" id="markdown-toc-prophet으로-시계열-예측">Prophet으로 시계열 예측</a></li>
</ol>
</li>
<li>
<a href="#%ED%8C%8C%EB%9D%BC%EB%AF%B8%ED%84%B0-%EC%A1%B0%EC%A0%95%ED%95%98%EA%B8%B0" id="markdown-toc-파라미터-조정하기">파라미터 조정하기</a><ol>
<li><a href="#trend-%EC%A1%B0%EC%A0%88-changepoint-%EC%A1%B0%EC%A0%88" id="markdown-toc-trend-조절-changepoint-조절">Trend 조절 (changepoint 조절)</a></li>
<li><a href="#seasonality-%EB%B0%98%EC%98%81" id="markdown-toc-seasonality-반영">Seasonality 반영</a></li>
<li><a href="#holiday-%EB%B0%98%EC%98%81" id="markdown-toc-holiday-반영">Holiday 반영</a></li>
<li><a href="#outlier-%EC%A0%9C%EC%99%B8%ED%95%98%EA%B8%B0" id="markdown-toc-outlier-제외하기">Outlier 제외하기</a></li>
</ol>
</li>
</ol></details><hr>
<p>*Facebook의 오픈소스 라이브러리인 ‘<a href="https://facebook.github.io/prophet/" target="_blank">Prophet</a>‘을 활용</p>
<h2 id="prophet-기초"> <a href="#prophet-%EA%B8%B0%EC%B4%88" aria-labelledby="prophet-기초" class="anchor-heading"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prophet 기초</h2>
<h3 id="이론"> <a href="#%EC%9D%B4%EB%A1%A0" aria-labelledby="이론" class="anchor-heading"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 이론</h3>
<ul>
<li>세 개의 주요 요소를 활용해 예측: Trend, Seasonality, Holiday</li>
<li>$ y(t) = g(t) + s(t) + h(t) + \epsilon_i $<ul>
<li>$g(t)$: the trend function. models non-periodic changes in the value of the time series.<br> 주기적이지 않은 변화를 반영 (트렌드를 반영)</li>
<li>$s(t)$: represents periodic changes (ex. weekly / yearly seasonality)<br> 주기적인 변화를 반영 (주, 일, 연 등의 기간에 따라 주기적으로 나타나는 흐름)</li>
<li>$h(t)$: represents the effects of holidays<br> 불규칙한 event인 휴일의 영향을 반영</li>
<li>$\epsilon_i$: the error term. represents any unusual changes not accommodated by the model <br> (정규분포를 따른다고 가정)</li>
</ul>
</li>
</ul>
<h3 id="시계열-데이터-준비"> <a href="#%EC%8B%9C%EA%B3%84%EC%97%B4-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A4%80%EB%B9%84" aria-labelledby="시계열-데이터-준비" class="anchor-heading"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 시계열 데이터 준비</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 필요한 library를 import
</span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">pandas_datareader</span> <span class="kn">import</span> <span class="n">data</span>
</code></pre></div></div>
<p>⁣1. Alphabet (Google 모기업) 주식 정보 가져오기</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>    <span class="c1">## cf) datetime.now()라고 하면 오늘 날짜로 가져옴
</span><span class="n">Google</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s">'GOOGL'</span><span class="p">,</span><span class="s">'yahoo'</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>   <span class="c1"># yahoo 주식 데이터에서 Alphabet 주식 데이터 가져옴
</span><span class="n">Google</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>
<div class="code-example"><div class="table-wrapper"><table>
<thead><tr>
<th style="text-align: left">Date</th>
<th style="text-align: right">High</th>
<th style="text-align: right">Low</th>
<th style="text-align: right">Open</th>
<th style="text-align: right">Close</th>
<th style="text-align: right">Volume</th>
<th style="text-align: right">Adj Close</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align: left">2020-01-02</td>
<td style="text-align: right">1368.68</td>
<td style="text-align: right">1346.49</td>
<td style="text-align: right">1348.41</td>
<td style="text-align: right">1368.68</td>
<td style="text-align: right">1363900</td>
<td style="text-align: right">1368.68</td>
</tr>
<tr>
<td style="text-align: left">2020-01-03</td>
<td style="text-align: right">1373.75</td>
<td style="text-align: right">1347.32</td>
<td style="text-align: right">1348</td>
<td style="text-align: right">1361.52</td>
<td style="text-align: right">1170400</td>
<td style="text-align: right">1361.52</td>
</tr>
<tr>
<td style="text-align: left">2020-01-06</td>
<td style="text-align: right">1398.32</td>
<td style="text-align: right">1351</td>
<td style="text-align: right">1351.63</td>
<td style="text-align: right">1397.81</td>
<td style="text-align: right">2338400</td>
<td style="text-align: right">1397.81</td>
</tr>
<tr>
<td style="text-align: left">2020-01-07</td>
<td style="text-align: right">1403.5</td>
<td style="text-align: right">1391.56</td>
<td style="text-align: right">1400.46</td>
<td style="text-align: right">1395.11</td>
<td style="text-align: right">1716500</td>
<td style="text-align: right">1395.11</td>
</tr>
<tr>
<td style="text-align: left">2020-01-08</td>
<td style="text-align: right">1411.85</td>
<td style="text-align: right">1392.63</td>
<td style="text-align: right">1394.82</td>
<td style="text-align: right">1405.04</td>
<td style="text-align: right">1765700</td>
<td style="text-align: right">1405.04</td>
</tr>
</tbody>
</table></div></div>
<p class="fs-1 lh-0"> </p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 종가(Close) 기준으로 그래프 그려보기
</span><span class="n">Google</span><span class="p">[</span><span class="s">'Close'</span><span class="p">].</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">grid</span><span class="o">=</span><span class="bp">True</span><span class="p">);</span>
</code></pre></div></div>
<p><img src="../../../assets/images/ml_applied/google_stock.png" alt="Google_Stock"></p>
<p class="fs-1 lh-0"> </p>
<p>⁣2. 2021.01 전까지로 데이터를 자르기</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 2020-12-31까지의 데이터만을 사용: 2021-05-01까지의 데이터를 예측해볼 예정
</span><span class="n">Google_2020</span> <span class="o">=</span> <span class="n">Google</span><span class="p">[:</span><span class="s">'2020-12-31'</span><span class="p">]</span>
<span class="n">Google_2020</span><span class="p">.</span><span class="n">tail</span><span class="p">()</span>
</code></pre></div></div>
<div class="code-example"><div class="table-wrapper"><table>
<thead><tr>
<th style="text-align: left">Date</th>
<th style="text-align: right">High</th>
<th style="text-align: right">Low</th>
<th style="text-align: right">Open</th>
<th style="text-align: right">Close</th>
<th style="text-align: right">Volume</th>
<th style="text-align: right">Adj Close</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align: left">2020-12-24</td>
<td style="text-align: right">1742.41</td>
<td style="text-align: right">1724.35</td>
<td style="text-align: right">1729</td>
<td style="text-align: right">1734.16</td>
<td style="text-align: right">465600</td>
<td style="text-align: right">1734.16</td>
</tr>
<tr>
<td style="text-align: left">2020-12-28</td>
<td style="text-align: right">1787</td>
<td style="text-align: right">1741.82</td>
<td style="text-align: right">1744.91</td>
<td style="text-align: right">1773.96</td>
<td style="text-align: right">1382500</td>
<td style="text-align: right">1773.96</td>
</tr>
<tr>
<td style="text-align: left">2020-12-29</td>
<td style="text-align: right">1788.47</td>
<td style="text-align: right">1755.11</td>
<td style="text-align: right">1787.23</td>
<td style="text-align: right">1757.76</td>
<td style="text-align: right">986300</td>
<td style="text-align: right">1757.76</td>
</tr>
<tr>
<td style="text-align: left">2020-12-30</td>
<td style="text-align: right">1767.76</td>
<td style="text-align: right">1728</td>
<td style="text-align: right">1765</td>
<td style="text-align: right">1736.25</td>
<td style="text-align: right">1051300</td>
<td style="text-align: right">1736.25</td>
</tr>
<tr>
<td style="text-align: left">2020-12-31</td>
<td style="text-align: right">1757.5</td>
<td style="text-align: right">1736.09</td>
<td style="text-align: right">1737.27</td>
<td style="text-align: right">1752.64</td>
<td style="text-align: right">1053500</td>
<td style="text-align: right">1752.64</td>
</tr>
</tbody>
</table></div></div>
<p>⁣3. Prophet에 학습시키기 위한 포맷으로 맞추기</p>
<ul><li>pandas.DataFrame with ‘y’ and ‘ds’ columns</li></ul>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Prophet에 학습시키려면 아래와 같은 포맷이여야 함
</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s">'ds'</span><span class="p">:</span><span class="n">Google_2020</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="s">'y'</span><span class="p">:</span><span class="n">Google_2020</span><span class="p">[</span><span class="s">'Close'</span><span class="p">]})</span>
<span class="n">df</span><span class="p">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>
<div class="code-example"><div class="table-wrapper"><table>
<thead><tr>
<th style="text-align: right"> </th>
<th style="text-align: left">ds</th>
<th style="text-align: right">y</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align: right">0</td>
<td style="text-align: left">2020-01-02</td>
<td style="text-align: right">1368.68</td>
</tr>
<tr>
<td style="text-align: right">1</td>
<td style="text-align: left">2020-01-03</td>
<td style="text-align: right">1361.52</td>
</tr>
<tr>
<td style="text-align: right">2</td>
<td style="text-align: left">2020-01-06</td>
<td style="text-align: right">1397.81</td>
</tr>
<tr>
<td style="text-align: right">3</td>
<td style="text-align: left">2020-01-07</td>
<td style="text-align: right">1395.11</td>
</tr>
<tr>
<td style="text-align: right">4</td>
<td style="text-align: left">2020-01-08</td>
<td style="text-align: right">1405.04</td>
</tr>
</tbody>
</table></div></div>
<h3 id="prophet으로-시계열-예측"> <a href="#prophet%EC%9C%BC%EB%A1%9C-%EC%8B%9C%EA%B3%84%EC%97%B4-%EC%98%88%EC%B8%A1" aria-labelledby="prophet으로-시계열-예측" class="anchor-heading"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prophet으로 시계열 예측</h3>
<ul>
<li>먼저 <code class="language-plaintext highlighter-rouge">pip install pystan</code>, <code class="language-plaintext highlighter-rouge">pip install prophet</code>으로 설치해줘야 사용 가능 (<a href="https://facebook.github.io/prophet/docs/installation.html#installation-in-python" target="_blank">설치 방법</a>)</li>
<li>Google Colaboratory에서는 별도의 설치 없이 import해서 사용 가능</li>
</ul>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">fbprophet</span> <span class="kn">import</span> <span class="n">Prophet</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">Prophet</span><span class="p">()</span>
<span class="n">m</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div></div>
<ul><li>yearly seasonality와 daily seasonality는 따로 써주지 않으면 반영되지 않음</li></ul>
<p class="fs-1 lh-0"> </p>
<p>⁣1. 2021.05.01까지의 주가를 예측해 봄</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">future</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">make_future_dataframe</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">121</span><span class="p">)</span>  <span class="c1"># 2021.05.01까지의 데이터를 예측할 예정 (=121일)
</span><span class="n">forecast</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>

<span class="n">forecast</span><span class="p">[[</span><span class="s">'ds'</span><span class="p">,</span> <span class="s">'yhat'</span><span class="p">,</span> <span class="s">'yhat_lower'</span><span class="p">,</span> <span class="s">'yhat_upper'</span><span class="p">]].</span><span class="n">tail</span><span class="p">()</span>
</code></pre></div></div>
<div class="code-example"><div class="table-wrapper"><table>
<thead><tr>
<th style="text-align: right"> </th>
<th style="text-align: left">ds</th>
<th style="text-align: right">yhat</th>
<th style="text-align: right">yhat_lower</th>
<th style="text-align: right">yhat_upper</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align: right">369</td>
<td style="text-align: left">2021-04-27</td>
<td style="text-align: right">2044.79</td>
<td style="text-align: right">1870.67</td>
<td style="text-align: right">2224.93</td>
</tr>
<tr>
<td style="text-align: right">370</td>
<td style="text-align: left">2021-04-28</td>
<td style="text-align: right">2050.44</td>
<td style="text-align: right">1880.35</td>
<td style="text-align: right">2231.62</td>
</tr>
<tr>
<td style="text-align: right">371</td>
<td style="text-align: left">2021-04-29</td>
<td style="text-align: right">2046.42</td>
<td style="text-align: right">1869.55</td>
<td style="text-align: right">2222.84</td>
</tr>
<tr>
<td style="text-align: right">372</td>
<td style="text-align: left">2021-04-30</td>
<td style="text-align: right">2050.11</td>
<td style="text-align: right">1872.39</td>
<td style="text-align: right">2221.89</td>
</tr>
<tr>
<td style="text-align: right">373</td>
<td style="text-align: left">2021-05-01</td>
<td style="text-align: right">2032.17</td>
<td style="text-align: right">1848.47</td>
<td style="text-align: right">2218.29</td>
</tr>
</tbody>
</table></div></div>
<p>⁣2. forecast 시각화해서 확인</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">forecast</span><span class="p">);</span>
</code></pre></div></div>
<p><img src="../../../assets/images/ml_applied/prophet_forecast1.png" alt="Forecast1"></p>
<p>⁣3. 요소별로 확인해보기</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m</span><span class="p">.</span><span class="n">plot_components</span><span class="p">(</span><span class="n">forecast</span><span class="p">);</span>
</code></pre></div></div>
<p><img src="../../../assets/images/ml_applied/prophet_components1.png" alt="Forecast_Components1"></p>
<p>⁣4. 2021년의 실제 데이터와 예측값을 비교해서 그려보기</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Google</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="n">Google</span><span class="p">[</span><span class="s">'Close'</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">'real'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">forecast</span><span class="p">[</span><span class="s">'ds'</span><span class="p">],</span> <span class="n">forecast</span><span class="p">[</span><span class="s">'yhat'</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">'forecast'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>
<p><img src="../../../assets/images/ml_applied/real_forecast_comparison.png" alt="Forecast_Real_Comparison"></p>
<h2 id="파라미터-조정하기"> <a href="#%ED%8C%8C%EB%9D%BC%EB%AF%B8%ED%84%B0-%EC%A1%B0%EC%A0%95%ED%95%98%EA%B8%B0" aria-labelledby="파라미터-조정하기" class="anchor-heading"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 파라미터 조정하기</h2>
<h3 id="trend-조절-changepoint-조절"> <a href="#trend-%EC%A1%B0%EC%A0%88-changepoint-%EC%A1%B0%EC%A0%88" aria-labelledby="trend-조절-changepoint-조절" class="anchor-heading"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Trend 조절 (changepoint 조절)</h3>
<ul>
<li>changepoint_range: changepoint 설정 가능 범위를 조절 (default: 80%)</li>
<li>changepoint_prior_scale: changepoint의 유연성 조절 (default: 0.5)</li>
<li>changepoints: 트렌드 변화 시점을 리스트로 직접 assign</li>
<li>n_changepoints: changepoint의 개수를 조절</li>
</ul>
<p class="fs-1 lh-0"> </p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## 기본으로 잡히는 changepoint 시각화해보기
</span>
<span class="kn">from</span> <span class="nn">fbprophet.plot</span> <span class="kn">import</span> <span class="n">add_changepoints_to_plot</span>  <span class="c1"># 필요한 함수
</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">Prophet</span><span class="p">(</span><span class="n">yearly_seasonality</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">daily_seasonality</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">m</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">future</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">make_future_dataframe</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">121</span><span class="p">)</span>
<span class="n">forecast</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">forecast</span><span class="p">)</span>
<span class="n">add_changepoints_to_plot</span><span class="p">(</span><span class="n">fig</span><span class="p">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">m</span><span class="p">,</span> <span class="n">forecast</span><span class="p">);</span>
</code></pre></div></div>
<p><img src="../../../assets/images/ml_applied/changepoint1.png" alt="Changepoint1"></p>
<p><strong>1. changepoint_range 조절</strong></p>
<ul><li>기본적으로 Prophet은 시계열 데이터의 80% 크기에서 ChangePoint를 지정<br> (overfitting을 피하기 위해 전체 데이터가 아닌 학습 데이터의 앞부분 80%의 데이터만을 사용해 변동점을 찾는 것)</li></ul>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># changepoint_range를 0.5로 변경
# 시계열 데이터의 앞 50%에서만 changepoint를 지정하라는 뜻
</span><span class="n">m</span> <span class="o">=</span> <span class="n">Prophet</span><span class="p">(</span><span class="n">yearly_seasonality</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">daily_seasonality</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">changepoint_range</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">m</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">future</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">make_future_dataframe</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">121</span><span class="p">)</span>
<span class="n">forecast</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">forecast</span><span class="p">)</span>
<span class="n">add_changepoints_to_plot</span><span class="p">(</span><span class="n">fig</span><span class="p">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">m</span><span class="p">,</span> <span class="n">forecast</span><span class="p">);</span>
</code></pre></div></div>
<p><img src="../../../assets/images/ml_applied/changepoint2.png" alt="Changepoint2"></p>
<p><strong>2. changepoint_prior_scale 조절</strong></p>
<ul>
<li>ChangePoint의 유연성을 조정하는 방법</li>
<li>기본 값은 0.05이며, 값을 늘리면 더 유연해지고(=underfitting 해결), 값을 줄이면 유연성 감소(=overfitting 해결)</li>
</ul>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># changepoint_prior_scale를 0.1로 늘려봄. 
# 0.05일 때(=default)보다 유동적으로 changepoint를 찾는 것을 알 수 있다. (→ overfitting 가능성)
</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">Prophet</span><span class="p">(</span><span class="n">yearly_seasonality</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">daily_seasonality</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">changepoint_prior_scale</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">m</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">future</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">make_future_dataframe</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">121</span><span class="p">)</span>
<span class="n">forecast</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">forecast</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">add_changepoints_to_plot</span><span class="p">(</span><span class="n">fig</span><span class="p">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">m</span><span class="p">,</span> <span class="n">forecast</span><span class="p">)</span>
</code></pre></div></div>
<p><img src="../../../assets/images/ml_applied/changepoint3.png" alt="Changepoint3"></p>
<p><strong>3. changepoints로 직접 날짜 assign</strong></p>
<ul>
<li>changepoint일 수 있는 날짜들을 직접 지정해주는 것.</li>
<li>changepoints에 값을 명시해주지 않으면 자동으로 changepoint들이 선택된다</li>
</ul>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># changepoint를 내가 직접 지정해줌
</span><span class="n">m</span> <span class="o">=</span> <span class="n">Prophet</span><span class="p">(</span><span class="n">yearly_seasonality</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">daily_seasonality</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">changepoints</span><span class="o">=</span><span class="p">[</span><span class="s">'2020-03-20'</span><span class="p">,</span> <span class="s">'2020-09-25'</span><span class="p">])</span>  
<span class="n">m</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">future</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">make_future_dataframe</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">121</span><span class="p">)</span>
<span class="n">forecast</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">forecast</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">add_changepoints_to_plot</span><span class="p">(</span><span class="n">fig</span><span class="p">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">m</span><span class="p">,</span> <span class="n">forecast</span><span class="p">)</span>
</code></pre></div></div>
<p><img src="../../../assets/images/ml_applied/changepoint4.png" alt="Changepoint4"></p>
<h3 id="seasonality-반영"> <a href="#seasonality-%EB%B0%98%EC%98%81" aria-labelledby="seasonality-반영" class="anchor-heading"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Seasonality 반영</h3>
<ul>
<li>yearly_seasonality: 연 주기의 계절성을 반영. default는 10.</li>
<li>weekly_seasonality: 주간 주기의 계절성을 반영. default는 3</li>
<li>daily_seasonality: 일 주기의 계절성을 반영. default는 4</li>
<li>seasonality_mode: ‘additive’ 혹은 ‘multiplicative’ (‘additive’가 default)</li>
<li>seasonality_prior_scale: 계절성 반영 강도</li>
</ul>
<p class="fs-1 lh-0"> </p>
<p><strong>1. yearly_seasonality</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># yearly_seasonality=True라고 해주면 default값인 10으로 설정됨
</span><span class="n">m</span> <span class="o">=</span> <span class="n">Prophet</span><span class="p">(</span><span class="n">yearly_seasonality</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>   
<span class="n">m</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">future</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">make_future_dataframe</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">121</span><span class="p">)</span>
<span class="n">forecast</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>

<span class="n">m</span><span class="p">.</span><span class="n">plot_components</span><span class="p">(</span><span class="n">forecast</span><span class="p">);</span>
</code></pre></div></div>
<p><img src="../../../assets/images/ml_applied/prophet_components2.png" alt="Forecast_Components2"></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 연 단위의 seasonality가 있다고 간주→ 2020년과 동일하게 3월에 급감하는 모양으로 예측
</span><span class="n">m</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">forecast</span><span class="p">);</span>   
</code></pre></div></div>
<p><img src="../../../assets/images/ml_applied/prophet_forecast2.png" alt="Forecast2"></p>
<p>+) yearly_seasonality의 강도 높여보기</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># yearly_seasonality를 20으로 설정해주면, default값인 10에 비해 더 연 계절성을 강하게 반영
</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">Prophet</span><span class="p">(</span><span class="n">yearly_seasonality</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">m</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">future</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">make_future_dataframe</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">121</span><span class="p">)</span>
<span class="n">forecast</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>

<span class="n">m</span><span class="p">.</span><span class="n">plot_components</span><span class="p">(</span><span class="n">forecast</span><span class="p">);</span>
</code></pre></div></div>
<p><img src="../../../assets/images/ml_applied/prophet_components3.png" alt="Forecast_Components3"></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">forecast</span><span class="p">);</span>   <span class="c1"># yearly_seasonlity가 더 강하게 반영됨  
</span></code></pre></div></div>
<p><img src="../../../assets/images/ml_applied/prophet_forecast3.png" alt="Forecast3"></p>
<p><strong>2. weekly_seasonality</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># weekly_seasonality는 따로 써주지 않아도 default로 3이 들어감. 20으로 넣으면 더 강하게 반영.
</span><span class="n">m</span> <span class="o">=</span> <span class="n">Prophet</span><span class="p">(</span><span class="n">weekly_seasonality</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>   
<span class="n">m</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">future</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">make_future_dataframe</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">121</span><span class="p">)</span>
<span class="n">forecast</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>

<span class="n">m</span><span class="p">.</span><span class="n">plot_components</span><span class="p">(</span><span class="n">forecast</span><span class="p">);</span>
</code></pre></div></div>
<p><img src="../../../assets/images/ml_applied/prophet_components4.png" alt="Forecast_Components4"></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">forecast</span><span class="p">);</span>   <span class="c1"># weekly_seasonlity가 강하게 반영됨 
</span></code></pre></div></div>
<p><img src="../../../assets/images/ml_applied/prophet_forecast4.png" alt="Forecast4"></p>
<p><strong>3. daily_seasonality</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># daily_seasonality=True라고 해주면 default값인 4으로 설정됨
</span><span class="n">m</span> <span class="o">=</span> <span class="n">Prophet</span><span class="p">(</span><span class="n">daily_seasonality</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">m</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">future</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">make_future_dataframe</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">121</span><span class="p">)</span>
<span class="n">forecast</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>

<span class="n">m</span><span class="p">.</span><span class="n">plot_components</span><span class="p">(</span><span class="n">forecast</span><span class="p">);</span>
</code></pre></div></div>
<p><img src="../../../assets/images/ml_applied/prophet_components5.png" alt="Forecast_Components5"></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">forecast</span><span class="p">);</span>   <span class="c1"># daily_seasonlity가 반영됨 
</span></code></pre></div></div>
<p><img src="../../../assets/images/ml_applied/prophet_forecast5.png" alt="Forecast5"></p>
<p>+) daily_seasonality의 강도 높여보기</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m</span> <span class="o">=</span> <span class="n">Prophet</span><span class="p">(</span><span class="n">daily_seasonality</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>  <span class="c1"># default: 4
</span><span class="n">m</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">future</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">make_future_dataframe</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">121</span><span class="p">)</span>
<span class="n">forecast</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>

<span class="n">m</span><span class="p">.</span><span class="n">plot_components</span><span class="p">(</span><span class="n">forecast</span><span class="p">);</span>
</code></pre></div></div>
<p><img src="../../../assets/images/ml_applied/prophet_components6.png" alt="Forecast_Components6"></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">forecast</span><span class="p">);</span>   <span class="c1"># daily_seasonlity가 강하게 반영됨 
</span></code></pre></div></div>
<p><img src="../../../assets/images/ml_applied/prophet_forecast6.png" alt="Forecast6"></p>
<p><strong>4. custom seasonality 추가</strong></p>
<ul><li>m.add_seasonality()로 직접 seasonality를 만들어 추가할 수 있다</li></ul>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># monthly seasonality 만들어서 추가해보기
</span><span class="n">m</span> <span class="o">=</span> <span class="n">Prophet</span><span class="p">()</span>
<span class="n">m</span><span class="p">.</span><span class="n">add_seasonality</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'monthly'</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="mf">30.5</span><span class="p">,</span> <span class="n">fourier_order</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">m</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">future</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">make_future_dataframe</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">121</span><span class="p">)</span>
<span class="n">forecast</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>

<span class="n">m</span><span class="p">.</span><span class="n">plot_components</span><span class="p">(</span><span class="n">forecast</span><span class="p">);</span>
</code></pre></div></div>
<p><img src="../../../assets/images/ml_applied/prophet_components7.png" alt="Forecast_Components7"></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">forecast</span><span class="p">);</span> 
</code></pre></div></div>
<p><img src="../../../assets/images/ml_applied/prophet_forecast7.png" alt="Forecast7"></p>
<p><strong>5. multiplicative seasonality</strong></p>
<ul>
<li>seasonality_mode: additive가 default</li>
<li>additive는 seasonality가 일정함을 의미하고, multiplicative는 seasonality가 트렌드와 함께 점점 증가함을 의미</li>
<li>multiplicative seasonality가 필요한 경우: <a href="https://facebook.github.io/prophet/docs/multiplicative_seasonality.html" target="_blank">number of air passengers 예시</a>
</li>
</ul>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># seasonality_mode='multiplicative'라고 설정해주면 점점 seasonality가 증가하는 것으로 반영됨
</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">Prophet</span><span class="p">(</span><span class="n">yearly_seasonality</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">daily_seasonality</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">seasonality_mode</span><span class="o">=</span><span class="s">'multiplicative'</span><span class="p">)</span>
<span class="n">m</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">future</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">make_future_dataframe</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">121</span><span class="p">)</span>
<span class="n">forecast</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>

<span class="n">m</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">forecast</span><span class="p">);</span>  <span class="c1"># 이 데이터에서는 사실 multiplicative seasonality가 필요하지 않음
</span></code></pre></div></div>
<p><img src="../../../assets/images/ml_applied/prophet_forecast8.png" alt="Forecast8"></p>
<h3 id="holiday-반영"> <a href="#holiday-%EB%B0%98%EC%98%81" aria-labelledby="holiday-반영" class="anchor-heading"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Holiday 반영</h3>
<ul>
<li>holidays: 휴일 / 이벤트 기간을 명시한 데이터프레임<ul><li>‘lower_window’, ‘upper_window’를 설정해 전후 기간에 미치는 휴일의 영향을 반영 가능</li></ul>
</li>
<li>holiday_prior_scale: holiday 반영 강도 (default는 10)<ul><li>holiday의 영향을 키우고 싶으면 숫자를 키우고, 영향을 줄이고 싶으면 숫자를 줄여서 써주면 됨</li></ul>
</li>
<li>m.add_country_holidays(country_name=’US’) 이렇게 하면 특정 국가의 공휴일 정보를 가져다 쓸 수 있음.</li>
</ul>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 직접 holiday 정보를 담은 dataframe을 생성
# lower_window=0, upper_window=1: 휴일이 전날에는 영향을 주지 않고, 다음날 하루 정도는 영향을 더 준다는 가정
</span><span class="n">holiday</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s">'holiday'</span><span class="p">:</span> <span class="s">'holiday'</span><span class="p">,</span>
    <span class="s">'ds'</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s">'2020-01-24'</span><span class="p">,</span> <span class="s">'2020-01-25'</span><span class="p">,</span> <span class="s">'2020-01-26'</span><span class="p">,</span>
                          <span class="s">'2021-02-11'</span><span class="p">,</span> <span class="s">'2021-02-12'</span><span class="p">,</span> <span class="s">'2021-02-13'</span><span class="p">]),</span>
    <span class="s">'lower_window'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s">'upper_window'</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">})</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">Prophet</span><span class="p">(</span><span class="n">holidays</span><span class="o">=</span><span class="n">holiday</span><span class="p">,</span> <span class="n">daily_seasonality</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">m</span><span class="p">.</span><span class="n">add_country_holidays</span><span class="p">(</span><span class="n">country_name</span><span class="o">=</span><span class="s">'US'</span><span class="p">)</span>  <span class="c1"># 내장되어 있는 휴일 정보를 불러와서 추가
</span>
<span class="n">m</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">future</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">make_future_dataframe</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">121</span><span class="p">)</span>
<span class="n">forecast</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>

<span class="n">m</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">forecast</span><span class="p">);</span>
</code></pre></div></div>
<p><img src="../../../assets/images/ml_applied/prophet_forecast9.png" alt="Forecast9"></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m</span><span class="p">.</span><span class="n">plot_components</span><span class="p">(</span><span class="n">forecast</span><span class="p">);</span>
</code></pre></div></div>
<p><img src="../../../assets/images/ml_applied/prophet_components8.png" alt="Forecast_Components8"></p>
<p>+) 어떤 holidy들이 training에 반영되었는지 확인:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m</span><span class="p">.</span><span class="n">train_holiday_names</span>
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0                         holiday
1                  New Year's Day
2      Martin Luther King Jr. Day
3           Washington's Birthday
4                    Memorial Day
5                Independence Day
6     Independence Day (Observed)
7                       Labor Day
8                    Columbus Day
9                    Veterans Day
10                   Thanksgiving
11                  Christmas Day
dtype: object
</code></pre></div></div>
<h3 id="outlier-제외하기"> <a href="#outlier-%EC%A0%9C%EC%99%B8%ED%95%98%EA%B8%B0" aria-labelledby="outlier-제외하기" class="anchor-heading"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Outlier 제외하기</h3>
<ul><li>특정 기간의 데이터가 유독 트렌드를 벗어나게 이상한 수치를 보일 경우, 제외하고 학습시킬 수도 있다</li></ul>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## 코로나 pandemic으로 주가가 급락-급증한 2020년 상반기 일부를 제외하고 학습
</span>
<span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s">'ds'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s">'2020-02-01'</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'ds'</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s">'2020-05-01'</span><span class="p">),</span> <span class="s">'y'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">Prophet</span><span class="p">(</span><span class="n">yearly_seasonality</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">daily_seasonality</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">m</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">future</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">make_future_dataframe</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">121</span><span class="p">)</span>

<span class="n">m</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">future</span><span class="p">));</span>
</code></pre></div></div>
<p><img src="../../../assets/images/ml_applied/prophet_forecast10.png" alt="Forecast10"></p>
<hr>
<footer><p class="text-small text-grey-dk-000 mb-0">Copyright © 2021 Chaeyun.<br>This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a Jekyll theme.</p></footer>
</div>
</div>
<div class="search-overlay"></div>
</div>
</body>
</html>
